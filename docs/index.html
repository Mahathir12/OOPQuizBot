<div class="menu">
  <button id="moreBtn">⋯</button>
  <div id="menuPanel" class="panel">
    <button id="openAnnModal">Post Announcement</button>
    <label class="upload">
      Upload PDF (teacher)
      <input type="file" id="pdfInput" accept="application/pdf" hidden>
    </label>
  </div>
</div>

<!-- simple modal -->
<div id="annModal" class="modal" hidden>
  <div class="sheet">
    <h3>New Announcement</h3>
    <textarea id="annText" rows="4" placeholder="Write announcement…"></textarea>
    <div class="actions">
      <button id="annSend">Send</button>
      <button id="annClose">Close</button>
    </div>
  </div>
</div>

<script>
  const moreBtn = document.getElementById('moreBtn');
  const panel = document.getElementById('menuPanel');
  moreBtn.onclick = ()=> panel.classList.toggle('open');

  const annModal = document.getElementById('annModal');
  document.getElementById('openAnnModal').onclick = ()=> annModal.hidden=false;
  document.getElementById('annClose').onclick = ()=> annModal.hidden=true;

  document.getElementById('annSend').onclick = async ()=>{
    const text = document.getElementById('annText').value.trim();
    if(!text) return;
    await fetch('/api/announce', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({text})});
    alert('Announcement posted'); annModal.hidden=true;
  };

  document.getElementById('pdfInput').onchange = async (e)=>{
    const f = e.target.files[0]; if(!f) return;
    const fd = new FormData(); fd.append('file', f);
    const r = await fetch('/api/upload', { method:'POST', body:fd });
    const j = await r.json();
    alert('Uploaded: ' + (j.saved?.[0] ?? ''));
  };
</script>
